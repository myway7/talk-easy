"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/token";
exports.ids = ["pages/api/token"];
exports.modules = {

/***/ "livekit-server-sdk":
/*!*************************************!*\
  !*** external "livekit-server-sdk" ***!
  \*************************************/
/***/ ((module) => {

module.exports = require("livekit-server-sdk");

/***/ }),

/***/ "lru-cache":
/*!****************************!*\
  !*** external "lru-cache" ***!
  \****************************/
/***/ ((module) => {

module.exports = import("lru-cache");;

/***/ }),

/***/ "console":
/*!**************************!*\
  !*** external "console" ***!
  \**************************/
/***/ ((module) => {

module.exports = require("console");

/***/ }),

/***/ "(api)/./src/lib/lru.ts":
/*!************************!*\
  !*** ./src/lib/lru.ts ***!
  \************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"lru\": () => (/* binding */ lru)\n/* harmony export */ });\n/* harmony import */ var lru_cache__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! lru-cache */ \"lru-cache\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([lru_cache__WEBPACK_IMPORTED_MODULE_0__]);\nlru_cache__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\nif (global != undefined && global.lru == undefined) {\n    global.lru = new lru_cache__WEBPACK_IMPORTED_MODULE_0__.LRUCache({\n        max: 500,\n        ttl: 1000 * 60 * 60 * 24\n    });\n}\nconst lru = global.lru;\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9zcmMvbGliL2xydS50cy5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFxQztBQUVyQyxJQUFHQyxVQUFVQyxhQUFhLE9BQWdCQyxHQUFHLElBQUlELFdBQVc7SUFDdkRELE9BQWVFLEdBQUcsR0FBRyxJQUFJSCwrQ0FBUUEsQ0FBQztRQUFFSSxLQUFLO1FBQUtDLEtBQUksT0FBTyxLQUFLLEtBQUs7SUFBRztBQUMzRSxDQUFDO0FBRU0sTUFBTUYsTUFBTSxPQUFnQkEsR0FBRyIsInNvdXJjZXMiOlsid2VicGFjazovL2Fub255bW91cy1jaGF0Ly4vc3JjL2xpYi9scnUudHM/NzUxNSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBMUlVDYWNoZSB9IGZyb20gXCJscnUtY2FjaGVcIjtcblxuaWYoZ2xvYmFsICE9IHVuZGVmaW5lZCAmJiAoZ2xvYmFsIGFzIGFueSkubHJ1ID09IHVuZGVmaW5lZCApe1xuICAgIChnbG9iYWwgYXMgYW55KS5scnUgPSBuZXcgTFJVQ2FjaGUoeyBtYXg6IDUwMCwgdHRsOjEwMDAgKiA2MCAqIDYwICogMjQgfSlcbn1cblxuZXhwb3J0IGNvbnN0IGxydSA9IChnbG9iYWwgYXMgYW55KS5scnUiXSwibmFtZXMiOlsiTFJVQ2FjaGUiLCJnbG9iYWwiLCJ1bmRlZmluZWQiLCJscnUiLCJtYXgiLCJ0dGwiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./src/lib/lru.ts\n");

/***/ }),

/***/ "(api)/./src/pages/api/token.ts":
/*!********************************!*\
  !*** ./src/pages/api/token.ts ***!
  \********************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"createToken\": () => (/* binding */ createToken),\n/* harmony export */   \"default\": () => (/* binding */ handleToken)\n/* harmony export */ });\n/* harmony import */ var livekit_server_sdk__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! livekit-server-sdk */ \"livekit-server-sdk\");\n/* harmony import */ var livekit_server_sdk__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(livekit_server_sdk__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _lib_lru__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/lru */ \"(api)/./src/lib/lru.ts\");\n/* harmony import */ var console__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! console */ \"console\");\n/* harmony import */ var console__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(console__WEBPACK_IMPORTED_MODULE_2__);\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_lib_lru__WEBPACK_IMPORTED_MODULE_1__]);\n_lib_lru__WEBPACK_IMPORTED_MODULE_1__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\nconst apiKey = \"APIiaviDgYVWBWs\";\nconst apiSecret = \"8AiDfO1ErLSqWEdrBeO33QHk52x4eVP3AFE7ykvGKKeB\";\nconst wsUrl = \"wss://ostrich.live/live_streamer\";\nconst createToken = (userInfo, grant)=>{\n    const at = new livekit_server_sdk__WEBPACK_IMPORTED_MODULE_0__.AccessToken(apiKey, apiSecret, userInfo);\n    at.ttl = \"5m\";\n    at.addGrant(grant);\n    return at.toJwt();\n};\n// TODO最后一个人离开房间时重置密码\nasync function handleToken(req, res) {\n    console.log(\"get token\");\n    const { roomName , identity , name , passwd , metadata  } = req.body;\n    console.log({\n        roomName,\n        identity,\n        name,\n        metadata\n    });\n    if (typeof identity !== \"string\" || typeof roomName !== \"string\") {\n        res.status(403).end();\n        return;\n    }\n    if (Array.isArray(name)) {\n        return res.status(500).json({\n            error: \"provide max one name\"\n        });\n    }\n    if (Array.isArray(metadata)) {\n        return res.status(500).json({\n            error: \"provide max one metadata string\"\n        });\n    }\n    if (!apiKey || !apiSecret || !wsUrl) {\n        return res.status(500).json({\n            error: \"Server misconfigured\"\n        });\n    }\n    const livekitHost = \"http://ostrich.live:7880/\";\n    const roomService = new livekit_server_sdk__WEBPACK_IMPORTED_MODULE_0__.RoomServiceClient(livekitHost, apiKey, apiSecret);\n    const grant = {\n        room: roomName,\n        roomJoin: true,\n        canPublish: true,\n        canPublishData: true,\n        canSubscribe: true,\n        roomAdmin: false\n    };\n    let metadataObj = undefined;\n    let metadataProcess = metadata;\n    const defaultMaxParticipants = process.env.LIVEKIT_DEFAULT_MAXPARTICIPANTS ? parseInt(process.env.LIVEKIT_DEFAULT_MAXPARTICIPANTS) : 10;\n    try {\n        const participants = await roomService.listParticipants(roomName);\n        if (participants.length == 0) throw (0,console__WEBPACK_IMPORTED_MODULE_2__.error)(\"room is empty\");\n        const roomLRUItem = _lib_lru__WEBPACK_IMPORTED_MODULE_1__.lru.get(roomName);\n        if (roomLRUItem != undefined && roomLRUItem.maxParticipants > 0 && participants.length >= roomLRUItem.maxParticipants) {\n            return res.status(500).json({\n                error: \"room is full\"\n            });\n        }\n        if (roomLRUItem.passwd != undefined && roomLRUItem.passwd != \"\" && roomLRUItem.passwd != passwd) {\n            return res.status(500).json({\n                error: \"passwd error\"\n            });\n        }\n    } catch  {\n        // If room doesn't exist, user is room admin\n        grant.roomAdmin = true;\n        // set no passwrd\n        if (_lib_lru__WEBPACK_IMPORTED_MODULE_1__.lru.get(roomName)) {\n            _lib_lru__WEBPACK_IMPORTED_MODULE_1__.lru[\"delete\"](roomName);\n        }\n        const t = {\n            passwd: \"\",\n            time: new Date().getTime(),\n            maxParticipants: defaultMaxParticipants\n        };\n        _lib_lru__WEBPACK_IMPORTED_MODULE_1__.lru.set(roomName, t);\n        try {\n            metadataObj = metadata ? {\n                ...JSON.parse(metadata),\n                admin: true\n            } : {\n                admin: true\n            };\n        } catch (error) {\n            metadataObj = {\n                admin: true\n            };\n        }\n        metadataProcess = JSON.stringify(metadataObj);\n        // for passwd debug\n        // console.log(metadataProcess)\n        console.log(`set passwd for ${roomName}`);\n        const t2 = _lib_lru__WEBPACK_IMPORTED_MODULE_1__.lru.get(roomName);\n    // console.log(`get passwd for ${roomName}, passwd: ${t2.passwd}`)\n    }\n    const token = createToken({\n        identity,\n        name,\n        metadata: metadataProcess\n    }, grant);\n    const result = {\n        identity,\n        accessToken: token,\n        isAdmin: grant.roomAdmin\n    };\n    res.status(200).json(result);\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LE1BQU02QixTQUFTLEdBQUcsSUFBSTtRQUN0QixpQkFBaUI7UUFDakIsSUFBR3pDLDZDQUFPLENBQUNzQixXQUFVO1lBQ2pCdEIsbURBQVUsQ0FBQ3NCO1FBQ2YsQ0FBQztRQUNELE1BQU1pQyxJQUFrQjtZQUFDOUIsUUFBUTtZQUFJK0IsTUFBTSxJQUFJQyxPQUFPQyxPQUFPO1lBQUlMLGlCQUFpQlI7UUFBc0I7UUFDeEc3Qyw2Q0FBTyxDQUFDc0IsVUFBVWlDO1FBRWxCLElBQUk7WUFDRmIsY0FBY2hCLFdBQVc7Z0JBQUMsR0FBR2tDLEtBQUtDLEtBQUssQ0FBQ25DLFNBQVM7Z0JBQUVvQyxPQUFPLElBQUk7WUFBQSxJQUFJO2dCQUFDQSxPQUFPLElBQUk7WUFBQSxDQUFDO1FBQ2pGLEVBQUUsT0FBTzdELE9BQU87WUFDZHlDLGNBQWM7Z0JBQUNvQixPQUFPLElBQUk7WUFBQTtRQUM1QjtRQUVBbEIsa0JBQWtCZ0IsS0FBS0csU0FBUyxDQUFDckI7UUFFakMsbUJBQW1CO1FBQ25CLCtCQUErQjtRQUMvQnRCLFFBQVFDLEdBQUcsQ0FBQyxDQUFDLGVBQWUsRUFBRUMsU0FBUyxDQUFDO1FBQ3hDLE1BQU0wQyxLQUFLaEUsNkNBQU8sQ0FBQ3NCO0lBQ25CLGtFQUFrRTtJQUN0RTtJQUVBLE1BQU0yQyxRQUFRdkQsWUFBWTtRQUFFYTtRQUFVQztRQUFNRSxVQUFVa0I7SUFBZ0IsR0FBR2hDO0lBQ3pFLE1BQU1zRCxTQUFzQjtRQUMxQjNDO1FBQ0E0QyxhQUFhRjtRQUNiRyxTQUFTeEQsTUFBTTZCLFNBQVM7SUFDMUI7SUFFQXRCLElBQUlTLE1BQU0sQ0FBQyxLQUFLSSxJQUFJLENBQUNrQztBQUN6QixDQUFDIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vYW5vbnltb3VzLWNoYXQvLi9zcmMvcGFnZXMvYXBpL3Rva2VuLnRzP2MyOTciXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTmV4dEFwaVJlcXVlc3QsIE5leHRBcGlSZXNwb25zZSB9IGZyb20gJ25leHQnO1xuXG5pbXBvcnQgeyBBY2Nlc3NUb2tlbiwgUm9vbVNlcnZpY2VDbGllbnQgfSBmcm9tICdsaXZla2l0LXNlcnZlci1zZGsnO1xuaW1wb3J0IHR5cGUgeyBBY2Nlc3NUb2tlbk9wdGlvbnMsIFZpZGVvR3JhbnQgfSBmcm9tICdsaXZla2l0LXNlcnZlci1zZGsnO1xuaW1wb3J0IHsgVG9rZW5SZXN1bHQsIFJvb21NZXRhZGF0YSB9IGZyb20gJy4uLy4uL2xpYi90eXBlcyc7XG5pbXBvcnQgeyBscnUgfSBmcm9tICdAL2xpYi9scnUnO1xuaW1wb3J0IHsgZXJyb3IgfSBmcm9tICdjb25zb2xlJztcblxuY29uc3QgYXBpS2V5ID0gcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfTElWRUtJVF9BUElfS0VZO1xuY29uc3QgYXBpU2VjcmV0ID0gcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfTElWRUtJVF9BUElfU0VDUkVUO1xuY29uc3Qgd3NVcmwgPSBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19MSVZFS0lUX1VSTDtcblxuZXhwb3J0IGNvbnN0IGNyZWF0ZVRva2VuID0gKHVzZXJJbmZvOiBBY2Nlc3NUb2tlbk9wdGlvbnMsIGdyYW50OiBWaWRlb0dyYW50KSA9PiB7XG4gIGNvbnN0IGF0ID0gbmV3IEFjY2Vzc1Rva2VuKGFwaUtleSwgYXBpU2VjcmV0LCB1c2VySW5mbyk7XG4gIGF0LnR0bCA9ICc1bSc7XG4gIGF0LmFkZEdyYW50KGdyYW50KTtcbiAgcmV0dXJuIGF0LnRvSnd0KCk7XG59O1xuLy8gVE9ET+acgOWQjuS4gOS4quS6uuemu+W8gOaIv+mXtOaXtumHjee9ruWvhueggVxuZXhwb3J0IGRlZmF1bHQgYXN5bmMgZnVuY3Rpb24gaGFuZGxlVG9rZW4ocmVxOiBOZXh0QXBpUmVxdWVzdCwgcmVzOiBOZXh0QXBpUmVzcG9uc2UpIHtcbiAgICBjb25zb2xlLmxvZyhcImdldCB0b2tlblwiKVxuICAgIGNvbnN0IHsgcm9vbU5hbWUsIGlkZW50aXR5LCBuYW1lLCBwYXNzd2QsIG1ldGFkYXRhIH0gPSByZXEuYm9keTtcbiAgICBjb25zb2xlLmxvZyh7IHJvb21OYW1lLCBpZGVudGl0eSwgbmFtZSwgbWV0YWRhdGEgfSApXG4gICAgaWYgKHR5cGVvZiBpZGVudGl0eSAhPT0gJ3N0cmluZycgfHwgdHlwZW9mIHJvb21OYW1lICE9PSAnc3RyaW5nJykge1xuICAgICAgcmVzLnN0YXR1cyg0MDMpLmVuZCgpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmIChBcnJheS5pc0FycmF5KG5hbWUpKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDUwMCkuanNvbih7IGVycm9yOiBcInByb3ZpZGUgbWF4IG9uZSBuYW1lXCJ9KTtcbiAgICB9XG4gICAgaWYgKEFycmF5LmlzQXJyYXkobWV0YWRhdGEpKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDUwMCkuanNvbih7IGVycm9yOiAncHJvdmlkZSBtYXggb25lIG1ldGFkYXRhIHN0cmluZyd9KTtcbiAgICB9XG5cbiAgICBpZiAoIWFwaUtleSB8fCAhYXBpU2VjcmV0IHx8ICF3c1VybCkge1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgZXJyb3I6IFwiU2VydmVyIG1pc2NvbmZpZ3VyZWRcIiB9KTtcbiAgICB9XG4gIFxuIGNvbnN0IGxpdmVraXRIb3N0ID0gcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfTEtfSFRUUF9VUkwhO1xuXG4gICAgY29uc3Qgcm9vbVNlcnZpY2UgPSBuZXcgUm9vbVNlcnZpY2VDbGllbnQobGl2ZWtpdEhvc3QsIGFwaUtleSwgYXBpU2VjcmV0KTtcbiAgICBcblxuICAgIGNvbnN0IGdyYW50OiBWaWRlb0dyYW50ID0ge1xuICAgICAgcm9vbTogcm9vbU5hbWUsXG4gICAgICByb29tSm9pbjogdHJ1ZSxcbiAgICAgIGNhblB1Ymxpc2g6IHRydWUsXG4gICAgICBjYW5QdWJsaXNoRGF0YTogdHJ1ZSxcbiAgICAgIGNhblN1YnNjcmliZTogdHJ1ZSxcbiAgICAgIHJvb21BZG1pbjogZmFsc2VcbiAgICB9O1xuXG4gICAgbGV0IG1ldGFkYXRhT2JqOiBhbnkgPSB1bmRlZmluZWRcbiAgICBsZXQgbWV0YWRhdGFQcm9jZXNzID0gbWV0YWRhdGE7XG4gICAgY29uc3QgZGVmYXVsdE1heFBhcnRpY2lwYW50cyA9IHByb2Nlc3MuZW52LkxJVkVLSVRfREVGQVVMVF9NQVhQQVJUSUNJUEFOVFMgPyBwYXJzZUludChwcm9jZXNzLmVudi5MSVZFS0lUX0RFRkFVTFRfTUFYUEFSVElDSVBBTlRTKSA6IDEwXG5cbiAgICB0cnl7XG4gICAgICAgIGNvbnN0IHBhcnRpY2lwYW50cyA9IGF3YWl0IHJvb21TZXJ2aWNlLmxpc3RQYXJ0aWNpcGFudHMocm9vbU5hbWUpO1xuICAgICAgICBpZihwYXJ0aWNpcGFudHMubGVuZ3RoID09IDApIHRocm93IGVycm9yKFwicm9vbSBpcyBlbXB0eVwiKTtcbiAgICAgICAgY29uc3Qgcm9vbUxSVUl0ZW06IFJvb21NZXRhZGF0YSA9IGxydS5nZXQocm9vbU5hbWUpXG4gICAgICAgIGlmKHJvb21MUlVJdGVtICE9IHVuZGVmaW5lZCAmJiByb29tTFJVSXRlbS5tYXhQYXJ0aWNpcGFudHMgPiAwICYmXG4gICAgICAgICBwYXJ0aWNpcGFudHMubGVuZ3RoID49IHJvb21MUlVJdGVtLm1heFBhcnRpY2lwYW50cyl7XG4gICAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg1MDApLmpzb24oeyBlcnJvcjogJ3Jvb20gaXMgZnVsbCd9KVxuICAgICAgICB9XG4gICAgICAgIGlmKHJvb21MUlVJdGVtLnBhc3N3ZCAhPSB1bmRlZmluZWQgJiYgcm9vbUxSVUl0ZW0ucGFzc3dkICE9IFwiXCIgJiYgcm9vbUxSVUl0ZW0ucGFzc3dkICE9IHBhc3N3ZCl7XG4gICAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg1MDApLmpzb24oeyBlcnJvcjogJ3Bhc3N3ZCBlcnJvcid9KVxuICAgICAgICB9XG4gICAgfWNhdGNoe1xuICAgICAgICAvLyBJZiByb29tIGRvZXNuJ3QgZXhpc3QsIHVzZXIgaXMgcm9vbSBhZG1pblxuICAgICAgICBncmFudC5yb29tQWRtaW4gPSB0cnVlO1xuICAgICAgICAvLyBzZXQgbm8gcGFzc3dyZFxuICAgICAgICBpZihscnUuZ2V0KHJvb21OYW1lKSl7XG4gICAgICAgICAgICBscnUuZGVsZXRlKHJvb21OYW1lKVxuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHQ6IFJvb21NZXRhZGF0YSA9IHtwYXNzd2Q6IFwiXCIsIHRpbWU6IG5ldyBEYXRlKCkuZ2V0VGltZSgpLCBtYXhQYXJ0aWNpcGFudHM6IGRlZmF1bHRNYXhQYXJ0aWNpcGFudHN9XG4gICAgICAgIGxydS5zZXQocm9vbU5hbWUsIHQpXG5cbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBtZXRhZGF0YU9iaiA9IG1ldGFkYXRhID8gey4uLkpTT04ucGFyc2UobWV0YWRhdGEpLCBhZG1pbjogdHJ1ZX0gOiB7YWRtaW46IHRydWV9O1xuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgIG1ldGFkYXRhT2JqID0ge2FkbWluOiB0cnVlfTtcbiAgICAgICAgfVxuXG4gICAgICAgIG1ldGFkYXRhUHJvY2VzcyA9IEpTT04uc3RyaW5naWZ5KG1ldGFkYXRhT2JqKVxuICAgIFxuICAgICAgICAvLyBmb3IgcGFzc3dkIGRlYnVnXG4gICAgICAgIC8vIGNvbnNvbGUubG9nKG1ldGFkYXRhUHJvY2VzcylcbiAgICAgICAgY29uc29sZS5sb2coYHNldCBwYXNzd2QgZm9yICR7cm9vbU5hbWV9YClcbiAgICAgICAgY29uc3QgdDIgPSBscnUuZ2V0KHJvb21OYW1lKSBhcyBSb29tTWV0YWRhdGE7XG4gICAgICAgIC8vIGNvbnNvbGUubG9nKGBnZXQgcGFzc3dkIGZvciAke3Jvb21OYW1lfSwgcGFzc3dkOiAke3QyLnBhc3N3ZH1gKVxuICAgIH1cblxuICAgIGNvbnN0IHRva2VuID0gY3JlYXRlVG9rZW4oeyBpZGVudGl0eSwgbmFtZSwgbWV0YWRhdGE6IG1ldGFkYXRhUHJvY2VzcyB9LCBncmFudCk7XG4gICAgY29uc3QgcmVzdWx0OiBUb2tlblJlc3VsdCA9IHtcbiAgICAgIGlkZW50aXR5LFxuICAgICAgYWNjZXNzVG9rZW46IHRva2VuLFxuICAgICAgaXNBZG1pbjogZ3JhbnQucm9vbUFkbWluIGFzIGJvb2xlYW5cbiAgICB9O1xuXG4gICAgcmVzLnN0YXR1cygyMDApLmpzb24ocmVzdWx0KTtcbn1cbiJdLCJuYW1lcyI6WyJBY2Nlc3NUb2tlbiIsIlJvb21TZXJ2aWNlQ2xpZW50IiwibHJ1IiwiZXJyb3IiLCJhcGlLZXkiLCJwcm9jZXNzIiwiZW52IiwiTkVYVF9QVUJMSUNfTElWRUtJVF9BUElfS0VZIiwiYXBpU2VjcmV0IiwiTkVYVF9QVUJMSUNfTElWRUtJVF9BUElfU0VDUkVUIiwid3NVcmwiLCJORVhUX1BVQkxJQ19MSVZFS0lUX1VSTCIsImNyZWF0ZVRva2VuIiwidXNlckluZm8iLCJncmFudCIsImF0IiwidHRsIiwiYWRkR3JhbnQiLCJ0b0p3dCIsImhhbmRsZVRva2VuIiwicmVxIiwicmVzIiwiY29uc29sZSIsImxvZyIsInJvb21OYW1lIiwiaWRlbnRpdHkiLCJuYW1lIiwicGFzc3dkIiwibWV0YWRhdGEiLCJib2R5Iiwic3RhdHVzIiwiZW5kIiwiQXJyYXkiLCJpc0FycmF5IiwianNvbiIsImxpdmVraXRIb3N0IiwiTkVYVF9QVUJMSUNfTEtfSFRUUF9VUkwiLCJyb29tU2VydmljZSIsInJvb20iLCJyb29tSm9pbiIsImNhblB1Ymxpc2giLCJjYW5QdWJsaXNoRGF0YSIsImNhblN1YnNjcmliZSIsInJvb21BZG1pbiIsIm1ldGFkYXRhT2JqIiwidW5kZWZpbmVkIiwibWV0YWRhdGFQcm9jZXNzIiwiZGVmYXVsdE1heFBhcnRpY2lwYW50cyIsIkxJVkVLSVRfREVGQVVMVF9NQVhQQVJUSUNJUEFOVFMiLCJwYXJzZUludCIsInBhcnRpY2lwYW50cyIsImxpc3RQYXJ0aWNpcGFudHMiLCJsZW5ndGgiLCJyb29tTFJVSXRlbSIsImdldCIsIm1heFBhcnRpY2lwYW50cyIsImRlbGV0ZSIsInQiLCJ0aW1lIiwiRGF0ZSIsImdldFRpbWUiLCJzZXQiLCJKU09OIiwicGFyc2UiLCJhZG1pbiIsInN0cmluZ2lmeSIsInQyIiwidG9rZW4iLCJyZXN1bHQiLCJhY2Nlc3NUb2tlbiIsImlzQWRtaW4iXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./src/pages/api/token.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = (__webpack_exec__("(api)/./src/pages/api/token.ts"));
module.exports = __webpack_exports__;

})();